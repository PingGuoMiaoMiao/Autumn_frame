/// é›†æˆç¤ºä¾‹ - å±•ç¤º ResourceResolverã€PropertyResolverã€BeanDefinition å’Œ ApplicationContext çš„ä½¿ç”¨
/// 
/// è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ Autumn IoC å®¹å™¨

fn main {
  println("=".repeat(60))
  println("Autumn IoC å®¹å™¨é›†æˆç¤ºä¾‹")
  println("=".repeat(60))
  println("")
  
  // ========== ç¬¬ä¸€éƒ¨åˆ†ï¼šåˆ›å»ºé…ç½® ==========
  println("ğŸ“ ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡é…ç½®å±æ€§")
  println("â”€".repeat(60))
  
  let config = [
    ("app.name", "MyApplication"),
    ("app.version", "1.0.0"),
    ("app.author", "Autumn Framework"),
    ("db.host", "localhost"),
    ("db.port", "3306"),
    ("db.username", "root"),
    ("db.password", "password"),
    ("db.database", "mydb"),
    ("cache.enabled", "true"),
    ("cache.ttl", "600")
  ]
  
  println("âœ“ å‡†å¤‡äº† \{config.length()} ä¸ªé…ç½®é¡¹")
  println("")
  
  // ========== ç¬¬äºŒéƒ¨åˆ†ï¼šåˆ›å»º IoC å®¹å™¨ ==========
  println("ğŸ—ï¸  ç¬¬äºŒæ­¥ï¼šåˆ›å»º ApplicationContext")
  println("â”€".repeat(60))
  
  let ctx = @ApplicationContext.ApplicationContext::new(config, "com.example")
  
  println("âœ“ ApplicationContext åˆ›å»ºæˆåŠŸ")
  println("  - PropertyResolver: å·²åŠ è½½")
  println("  - ResourceResolver: å·²åŠ è½½")
  println("  - Bean å®¹å™¨: å·²åˆå§‹åŒ–")
  println("")
  
  // ========== ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ¼”ç¤º PropertyResolver åŠŸèƒ½ ==========
  println("âš™ï¸  ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯• PropertyResolver åŠŸèƒ½")
  println("â”€".repeat(60))
  
  // è·å–å­—ç¬¦ä¸²é…ç½®
  match ctx.get_property("app.name") {
    Some(name) => println("âœ“ app.name = \{name}")
    None => println("âœ— app.name æœªæ‰¾åˆ°")
  }
  
  match ctx.get_property("app.version") {
    Some(version) => println("âœ“ app.version = \{version}")
    None => println("âœ— app.version æœªæ‰¾åˆ°")
  }
  
  // è·å– Int é…ç½®
  match ctx.get_property_int("db.port") {
    Some(port) => println("âœ“ db.port = \{port} (Int)")
    None => println("âœ— db.port æœªæ‰¾åˆ°æˆ–æ ¼å¼é”™è¯¯")
  }
  
  match ctx.get_property_int("cache.ttl") {
    Some(ttl) => println("âœ“ cache.ttl = \{ttl} ç§’ (Int)")
    None => println("âœ— cache.ttl æœªæ‰¾åˆ°æˆ–æ ¼å¼é”™è¯¯")
  }
  
  // è·å– Bool é…ç½®
  match ctx.get_property_bool("cache.enabled") {
    Some(enabled) => println("âœ“ cache.enabled = \{enabled} (Bool)")
    None => println("âœ— cache.enabled æœªæ‰¾åˆ°æˆ–æ ¼å¼é”™è¯¯")
  }
  
  println("")
  
  // ========== ç¬¬å››éƒ¨åˆ†ï¼šæ³¨å†Œ Bean å®šä¹‰ ==========
  println("ğŸ“¦ ç¬¬å››æ­¥ï¼šæ³¨å†Œ Bean å®šä¹‰")
  println("â”€".repeat(60))
  
  // æ³¨å†Œæ•°æ®åº“ç›¸å…³ Bean
  ctx.register_bean(
    "dataSource",
    "com.example.db.DataSource",
    10,  // order: å…ˆåˆ›å»º
    true  // primary
  )
  println("âœ“ æ³¨å†Œ Bean: dataSource (order=10, primary=true)")
  
  ctx.register_bean(
    "transactionManager",
    "com.example.db.TransactionManager",
    20,  // order: ä¾èµ– dataSource
    false
  )
  println("âœ“ æ³¨å†Œ Bean: transactionManager (order=20)")
  
  // æ³¨å†ŒæœåŠ¡å±‚ Bean
  ctx.register_bean(
    "userService",
    "com.example.service.UserService",
    30,
    false
  )
  println("âœ“ æ³¨å†Œ Bean: userService (order=30)")
  
  ctx.register_bean(
    "orderService",
    "com.example.service.OrderService",
    30,
    false
  )
  println("âœ“ æ³¨å†Œ Bean: orderService (order=30)")
  
  // æ³¨å†Œæ§åˆ¶å™¨ Bean
  ctx.register_bean(
    "userController",
    "com.example.controller.UserController",
    40,
    false
  )
  println("âœ“ æ³¨å†Œ Bean: userController (order=40)")
  
  println("")
  
  // ========== ç¬¬äº”éƒ¨åˆ†ï¼šåˆ›å»º Bean å®ä¾‹ ==========
  println("ğŸ”¨ ç¬¬äº”æ­¥ï¼šåˆ›å»º Bean å®ä¾‹ï¼ˆæŒ‰é¡ºåºï¼‰")
  println("â”€".repeat(60))
  
  ctx.create_all_beans()
  
  println("")
  
  // ========== ç¬¬å…­éƒ¨åˆ†ï¼šæŸ¥çœ‹å®¹å™¨çŠ¶æ€ ==========
  println("ğŸ“Š ç¬¬å…­æ­¥ï¼šæŸ¥çœ‹å®¹å™¨çŠ¶æ€")
  println("â”€".repeat(60))
  
  ctx.print_summary()
  
  println("")
  
  // ========== ç¬¬ä¸ƒéƒ¨åˆ†ï¼šéªŒè¯ Bean åˆ›å»º ==========
  println("âœ… ç¬¬ä¸ƒæ­¥ï¼šéªŒè¯ Bean æ˜¯å¦æ­£ç¡®åˆ›å»º")
  println("â”€".repeat(60))
  
  match ctx.find_bean("dataSource") {
    Some(def) => {
      if def.has_instance() {
        println("âœ“ dataSource: å·²åˆ›å»ºå®ä¾‹")
        println("  - ç±»å‹: \{def.get_bean_class()}")
        println("  - Primary: \{def.is_primary()}")
        println("  - Order: \{def.get_order()}")
      } else {
        println("âœ— dataSource: æœªåˆ›å»ºå®ä¾‹")
      }
    }
    None => println("âœ— dataSource: Bean å®šä¹‰ä¸å­˜åœ¨")
  }
  
  println("")
  
  match ctx.find_bean("userService") {
    Some(def) => {
      if def.has_instance() {
        println("âœ“ userService: å·²åˆ›å»ºå®ä¾‹")
        println("  - ç±»å‹: \{def.get_bean_class()}")
      } else {
        println("âœ— userService: æœªåˆ›å»ºå®ä¾‹")
      }
    }
    None => println("âœ— userService: Bean å®šä¹‰ä¸å­˜åœ¨")
  }
  
  println("")
  
  // ========== æ€»ç»“ ==========
  println("=".repeat(60))
  println("âœ¨ é›†æˆç¤ºä¾‹å®Œæˆï¼")
  println("=".repeat(60))
  println("")
  println("æœ¬ç¤ºä¾‹å±•ç¤ºäº†ï¼š")
  println("  1. âœ… PropertyResolver - é…ç½®ç®¡ç†ï¼ˆString/Int/Boolï¼‰")
  println("  2. âœ… BeanDefinition - Bean å®šä¹‰ï¼ˆorderã€primaryï¼‰")
  println("  3. âœ… ApplicationContext - IoC å®¹å™¨é›†æˆ")
  println("  4. âœ… Bean ç”Ÿå‘½å‘¨æœŸ - æŒ‰é¡ºåºåˆ›å»º")
  println("")
  println("ä¸‹ä¸€æ­¥å¯ä»¥å®ç°ï¼š")
  println("  â€¢ ResourceResolver çš„å®é™…ä½¿ç”¨ï¼ˆæ‰«æç±»æ–‡ä»¶ï¼‰")
  println("  â€¢ ä¾èµ–æ³¨å…¥ï¼ˆ@Autowiredï¼‰")
  println("  â€¢ åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•è°ƒç”¨")
  println("  â€¢ å·¥å‚æ–¹æ³•åˆ›å»º Bean")
  println("")
}

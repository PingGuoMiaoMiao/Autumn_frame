# Autumn_frame ä½¿ç”¨æŒ‡å—

> Autumn_frame å°±æ˜¯æŠŠ Spring Boot ç»å…¸å¥—è·¯æ¬åˆ° Moonbit ä¸Šï¼šIoC + MVC + AOP + JDBC + Bootï¼Œè‡ªå·±å¸¦ HTTP Serverï¼Œç›´æ¥æœ¬åœ°ç¼–è¯‘æˆæœ¬æœºäºŒè¿›åˆ¶ã€‚

---

## ç›®å½•

1. [ç®€ä»‹](#ç®€ä»‹)
   - [å½“å‰å®Œæˆè¿›åº¦](#å½“å‰å®Œæˆè¿›åº¦2025-12-01)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [å®æˆ˜ï¼šè¿è¡Œ autumn-demo](#å®æˆ˜è¿è¡Œ-autumn-demo)
4. [æ ¸å¿ƒæ¦‚å¿µä¸ API](#æ ¸å¿ƒæ¦‚å¿µä¸-api)
   - [IoC ä¸ä¾èµ–æ³¨å…¥](#ioc-ä¸ä¾èµ–æ³¨å…¥)
   - [Web æ§åˆ¶å™¨](#web-æ§åˆ¶å™¨)
   - [é…ç½®ä¸å±æ€§æ³¨å…¥](#é…ç½®ä¸å±æ€§æ³¨å…¥)
   - [ç”Ÿå‘½å‘¨æœŸä¸ä¸Šä¸‹æ–‡](#ç”Ÿå‘½å‘¨æœŸä¸ä¸Šä¸‹æ–‡)
   - [AOP ä¸æ‹¦æˆªå™¨](#aop-ä¸æ‹¦æˆªå™¨)
   - [å¼‚å¸¸å¤„ç†ä¸æ—¥å¿—](#å¼‚å¸¸å¤„ç†ä¸æ—¥å¿—)
5. [é¡¹ç›®ç»“æ„å»ºè®®](#é¡¹ç›®ç»“æ„å»ºè®®)
6. [ä¸ Java Spring çš„å¼‚åŒ](#ä¸-java-spring-çš„å¼‚åŒ)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
8. [å‚è€ƒä¸åç»­è®¡åˆ’](#å‚è€ƒä¸åç»­è®¡åˆ’)

---

## ç®€ä»‹

Autumn_frame é¢å‘ Moonbit è¯­è¨€ï¼Œæ²¿è¢­ Spring/Spring Boot çš„è®¾è®¡ï¼šIoC å®¹å™¨è´Ÿè´£è£…é…ï¼ŒWebMVC ç®¡è¯·æ±‚ï¼ŒAOP åšæ¨ªåˆ‡ï¼ŒJDBC è´Ÿè´£æ•°æ®åº“ï¼ŒBoot æŠŠæœåŠ¡å™¨æ‹‰èµ·æ¥ã€‚Moonbit æ²¡æœ‰æ³¨è§£ï¼Œäºæ˜¯ç”¨å‡½æ•°å¼ API æ¨¡æ‹ŸåŒæ ·çš„ä½“éªŒã€‚

### æ¡†æ¶ç›®æ ‡

- **IoC ä¸ä¾èµ–æ³¨å…¥**ï¼šé€šè¿‡å®¹å™¨ç»Ÿä¸€ç®¡ç† Bean çš„å£°æ˜ã€åˆå§‹åŒ–å’Œè£…é…ï¼Œé™ä½æ¨¡å—è€¦åˆã€‚
- **è·¯ç”±æ˜ å°„ä¸æ§åˆ¶å™¨**ï¼šæä¾› `@Controller`/`@RestController` é£æ ¼çš„ APIï¼Œå¿«é€Ÿå®šä¹‰ HTTP æ¥å£ã€‚
- **é…ç½®é©±åŠ¨**ï¼šæ”¯æŒä»é…ç½®æºåŠ è½½å±æ€§ï¼Œå¹¶æ³¨å…¥åˆ° Bean æˆ–è¿è¡Œæ—¶ç¯å¢ƒã€‚
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæä¾› Bean åˆå§‹åŒ–ã€é”€æ¯ã€ä¸Šä¸‹æ–‡é’©å­ç­‰èƒ½åŠ›ã€‚
- **AOP/æ‹¦æˆªå™¨**ï¼šé€šè¿‡åˆ‡é¢æ‹¦æˆªè¯·æ±‚æˆ–ä¸šåŠ¡é€»è¾‘ï¼Œæ»¡è¶³è·¨åˆ‡é¢åœºæ™¯ï¼ˆæ—¥å¿—ã€é‰´æƒã€äº‹åŠ¡ï¼‰ã€‚
- **ç®€å•åŒ–éƒ¨ç½²ä½“éªŒ**ï¼šå†…ç½®è½»é‡ Web æœåŠ¡å™¨ï¼Œå¼€ç®±å³ç”¨ã€‚

### å·²å®ç°çš„æ ¸å¿ƒèƒ½åŠ›

- åŸºäº `ApplicationContext` çš„ IoC å®¹å™¨ä¸ Bean ç®¡ç†ã€‚
- Bean æ‰«æã€æ³¨å†Œã€ä¾èµ–æ³¨å…¥ï¼ˆ`@Component`ã€`@Service`ã€`@Autowired` é£æ ¼ APIï¼‰ã€‚
- Web æ§åˆ¶å™¨ä½“ç³»ï¼ˆ`@Controller`/`@RestController`ã€HTTP åŠ¨è¯æ˜ å°„ï¼‰ã€‚
- è·¯ç”±åŒ¹é…ã€è·¯å¾„å˜é‡è§£æã€ç»Ÿä¸€ Dispatcherã€‚
- é…ç½®ä¸­å¿ƒï¼ˆç±»ä¼¼ `application.toml` å’Œ `@Value` æ³¨å…¥ï¼‰ã€‚
- åŸºç¡€ AOP æ”¯æŒï¼šæ–¹æ³•æ‹¦æˆªå™¨ã€å‰åç½® Adviceã€‚
- ç»Ÿä¸€å¼‚å¸¸æ•è·ä¸ HttpResponse æ„å»ºã€‚
- å†…ç½® BootApplication å¯åŠ¨å™¨ï¼Œå¿«é€Ÿå¯åŠ¨å†…ç½® HTTP æœåŠ¡å™¨ã€‚

### å½“å‰å®Œæˆè¿›åº¦ï¼ˆ2025-12-01ï¼‰

- **Autumn-Frame æ ¸å¿ƒ**ï¼šIoCã€WebMVCã€AOPã€JDBCã€Boot æ¨¡å—å‡å¯åœ¨ Moonbit 0.4.34 ç¼–è¯‘é€šè¿‡ï¼Œæ”¯æŒ `code_unit_at` ç­‰æœ€æ–°è¯­æ³•ï¼ˆæ—§æ¥å£ä¼šæç¤º Warningï¼Œæœªæ¥ç‰ˆæœ¬å°†é€æ­¥æ›¿æ¢ï¼‰ã€‚
- **æ•°æ®åº“æ”¯æŒ**ï¼šé€šè¿‡ `Autumn-JDBC` + C FFI å·²éªŒè¯ SQLiteã€MariaDB/MySQLã€PostgreSQLï¼ˆå½“å‰ demo é‡ç‚¹æ¼”ç¤º MariaDB `blog` åº“çš„ `users/post/comment/post_backup` CRUDï¼‰ã€‚
- **è§†é¢‘ç¤¾åŒºç¤ºä¾‹**ï¼š`autumn-demo/main.mbt` é›†æˆç”¨æˆ·ã€è§†é¢‘ã€æœç´¢ã€AIã€ç³»ç»Ÿé…ç½®ã€WebSocket ç­‰ REST APIï¼Œå¹¶åŠ¨æ€æŒ‚è½½åšå®¢ CRUD æ§åˆ¶å™¨ã€‚
- **æ–‡æ¡£ä½“ç³»**ï¼šæ ¹ç›®å½•åŒ…å« `README.md`ï¼ˆé¡¹ç›®é¸Ÿç°ï¼‰ä¸æœ¬æŒ‡å— `ä½¿ç”¨æŒ‡å—.md`ï¼ˆMoonbit è¯­æ³• + æ¡†æ¶ APIï¼‰ï¼Œå¦å¤–æä¾›å‰ç«¯å¯¹æ¥æ–‡æ¡£ä¸ç¤ºä¾‹ READMEã€‚
- **å·¥å…·é“¾å…¼å®¹æ€§**ï¼šå·²åœ¨ Linux 6.17 + Moon CLI ä¸‹éªŒè¯ `moon run --target native autumn-demo/main.mbt`ï¼Œå¹¶ç»™å‡º MariaDB è¿æ¥æ—¥å¿—ä¸æ¥å£è¾“å‡ºã€‚

---

## å¿«é€Ÿå¼€å§‹

ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªé›¶åŸºç¡€ç”¨æˆ·å¦‚ä½•åœ¨ MoonSpring ä¸Šè·‘é€šç¬¬ä¸€ä¸ª Web æ¥å£ã€‚

### 1. å‡†å¤‡å·¥ç¨‹

```bash
moon new hello_world
cd hello_world
```

åœ¨ `moon.mod.json` ä¸­å£°æ˜ä¾èµ–ï¼ˆæ­¤å¤„ä½¿ç”¨ä»“åº“è·¯å¾„ç¤ºä¾‹ï¼Œè¯·æ ¹æ®å®é™…å‘å¸ƒè·¯å¾„è°ƒæ•´ï¼‰ï¼š

```bash
moon add 
```

### 2. é…ç½®åŒ…å¯¼å…¥

 MoonSpring ä¾èµ– Moonbit çš„åŒ…ç®¡ç†æœºåˆ¶ã€‚è¯·åœ¨å½“å‰ç›®å½•åˆ›å»ºï¼ˆæˆ–æ›´æ–°ï¼‰`moon.pkg.json`ï¼Œå£°æ˜éœ€è¦å¼•å…¥çš„æ¡†æ¶æ¨¡å—å¹¶ä¸ºå…¶è®¾ç½®åˆ«åï¼ŒåŒæ—¶é…ç½®åµŒå…¥å¼æœåŠ¡å™¨çš„é¢„ç¼–è¯‘ä¸é“¾æ¥æ­¥éª¤ï¼š

```json
{
  "is-main": true,
  "import": [
    { "path": "username/Autumn_frame/autumn-frame/Autumn-Ioc/ApplicationContext", "alias": "ApplicationContext" },
    { "path": "username/Autumn_frame/autumn-frame/Autumn-WebMVC/Controller" },
    { "path": "username/Autumn_frame/autumn-frame/Autumn-WebMVC/Dispatcher", "alias": "Dispatcher" },
    { "path": "username/Autumn_frame/autumn-frame/Autumn-WebMVC/Http", "alias": "Http" },
    { "path": "username/Autumn_frame/autumn-frame/Autumn-Boot", "alias": "Boot" }
  ],
  "pre-build": [
    {
      "input": ["../autumn-frame/Autumn-Boot/Server/http_server.c"],
      "output": ["http_server.o"],
      "command": "gcc -c -I$HOME/.moon/include -fwrapv -fno-strict-aliasing -O2 $input -o $output"
    }
  ],
  "link": {
    "native": {
      "cc": "/usr/bin/gcc",
      "native-stub": [
        "../autumn-frame/Autumn-Boot/Server/http_server.c"
      ],
      "cc-link-flags": "-fwrapv -fno-strict-aliasing /absolute/path/to/your/project/http_server.o"
    }
  ],
  "source": [
    "main.mbt"
  ]
}
```

> è¯·å°† `cc-link-flags` ä¸­çš„è·¯å¾„æ›¿æ¢ä¸ºæœ¬åœ°ç”Ÿæˆçš„ `http_server.o` ç»å¯¹è·¯å¾„ï¼Œå¯å‚è€ƒä»“åº“å†… `samples/moonspring-hello/moon.pkg.json` çš„å†™æ³•ã€‚å…³äºåŒ…å¯¼å…¥ä¸åˆ«åè§„åˆ™ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<https://docs.moonbitlang.cn/language/packages.html>

### 3. åˆ›å»ºæœ€å°åº”ç”¨

`main.mbt`ï¼š

```moonbit
fn main {
  // 1. åˆå§‹åŒ–é…ç½®ä¸ IoC å®¹å™¨
  let config = [
    ("server.port", "8080"),
    ("app.name", "MoonSpringHello")
  ]
  let ctx = @ApplicationContext.ApplicationContext::new(config, "demo")

  // 2. å®šä¹‰ REST æ§åˆ¶å™¨
  let hello_controller = @Controller.RestController::new("/hello")
    .get("/", fn(_req : @Http.HttpRequest) {
      let body = @hashmap.new()
      body.set("message", "Hello MoonSpring!")
      @Controller.JsonResponse::new(body)
    })

  // 3. æ³¨å†Œæ§åˆ¶å™¨å¹¶å¯åŠ¨æœåŠ¡å™¨
  let dispatcher = @Dispatcher.DispatcherServlet::new()
    .register_rest_controller("helloController", hello_controller)

  println("ğŸš€ MoonSpring å¯åŠ¨ä¸­: http://localhost:8080/hello")
  @Boot.BootApplication::run(8080, fn() { dispatcher })
}
```

æ‰§è¡Œï¼š

```bash
moon run --target native main.mbt
```

æµè§ˆå™¨è®¿é—® `http://localhost:8080/hello`ï¼Œå³å¯å¾—åˆ° JSON å“åº”ã€‚ä»“åº“ä¸­å·²éšæŒ‡å—æä¾›å®Œæ•´ç¤ºä¾‹ `samples/moonspring-hello/`ï¼Œå¦‚éœ€éªŒè¯ï¼Œå¯åœ¨ä»“åº“æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
moon run --target native samples/moonspring-hello/main.mbt
```

ç¤ºä¾‹å“åº”ï¼š

```json
{"message":"Hello MoonSpring!","app":"MoonSpringHello"}
```

> âš ï¸ å¦‚æœä½ ç›´æ¥ä½¿ç”¨ä»“åº“é‡Œçš„ `autumn-demo` / `mysql-demo` / `ffi-demo` ç­‰ç¤ºä¾‹ï¼Œè¯·**å…ˆè¿›å…¥å¯¹åº”ç›®å½•**å†è¿è¡Œ `moon run --target native main.mbt`ã€‚è¿™äº› demo çš„ `moon.pkg.json` é€šè¿‡ `$PWD` å¼•ç”¨æœ¬ç›®å½•ä¸‹çš„ `*.o` æ–‡ä»¶ï¼Œåªæœ‰åœ¨æ­£ç¡®ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤æ—¶ shell æ‰ä¼šå±•å¼€è·¯å¾„ï¼›å¦åˆ™é“¾æ¥é˜¶æ®µä¼šæç¤ºæ‰¾ä¸åˆ° `$PWD/.../wrapper.o`ã€‚

---

## å®æˆ˜ï¼šè¿è¡Œ autumn-demo

> è¿™ä¸€ç« è®°å½•äº†æˆ‘åœ¨ 2025-12-01 åŸºäºæœ€æ–° Moonbit è¯­æ³•äº²æµ‹ `autumn-demo` çš„å®Œæ•´æ­¥éª¤ï¼Œè®©ä½ å¯ä»¥å¤åˆ¶åŒæ ·çš„ç¯å¢ƒå¹¶ç¡®è®¤æ‰€æœ‰æ¥å£éƒ½æ­£å¸¸å·¥ä½œã€‚

### è¿è¡Œå‰ç½®æ¡ä»¶

- Moonbit CLI â‰¥ 0.4.34ï¼ˆ`moon --version` æŸ¥çœ‹ï¼‰ã€‚
- ç³»ç»Ÿå·²å®‰è£… `gcc`ã€`make` ä»¥åŠ `libmysqlclient`ã€`libsqlite3`ã€`libpq` è¿è¡Œåº“ã€‚
- æœ¬ä»“åº“ä½äº `/home/pingguomiaomiao/Desktop/Autumn_frame`ï¼ŒMariaDB æœ¬åœ°å®ä¾‹å¯é€šè¿‡ `jdbc:mariadb://localhost:3306/blog` è®¿é—®ï¼Œè´¦å· `root/123456`ã€‚
- è‹¥ä½ åœ¨è‡ªå®šä¹‰è·¯å¾„ï¼Œè¯·åŒæ­¥æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ä¸­çš„ç»å¯¹è·¯å¾„ï¼š
  - `autumn-demo/moon.pkg.json`ï¼ˆ`mysql_wrapper.o`ï¼‰
  - `mysql-demo/moon.pkg.json`
  - `ffi-demo/moon.pkg.json`

### å¯åŠ¨æ­¥éª¤

```bash
cd /home/pingguomiaomiao/Desktop/Autumn_frame
moon run --target native autumn-demo/main.mbt
```

ç¨‹åºä¼šè‡ªåŠ¨ï¼š

1. ç¼–è¯‘ C FFIï¼ˆ`mysql_wrapper.c`ã€`http_server.c`ï¼‰å¹¶é“¾æ¥ã€‚
2. åˆå§‹åŒ– IoC å®¹å™¨ã€æ³¨å†Œç”¨æˆ·/è§†é¢‘/åšå®¢ CRUD Controllerã€‚
3. æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹è‡ªæ£€ï¼š
   - è®¿é—® `/api/system/logs`ã€`/api/user/register` ç­‰æ¥å£ï¼Œç¡®ä¿ JSON ç¼–è§£ç ä¸è·¯ç”±è¡¨æ— è¯¯ã€‚
   - ä½¿ç”¨ `Autumn-JDBC` ä¸ MariaDB å»ºç«‹è¿æ¥ï¼Œæ‰§è¡Œ `SHOW TABLES`ã€`SELECT DATABASE()`ã€`DESCRIBE comment/post/post_backup` å¹¶è¾“å‡º DEBUG æ—¥å¿—ã€‚
4. å¯åŠ¨åµŒå…¥å¼æœåŠ¡å™¨ï¼Œç›‘å¬ `http://localhost:8080`ã€‚

å¦‚æœä¾èµ–æ»¡è¶³ï¼Œä½ å°†çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
âœ“ å‡†å¤‡å¯åŠ¨åµŒå…¥å¼æœåŠ¡å™¨...  ç«¯å£: 8080
[Server] Starting embedded server on port 8080
DEBUG: MySQL connection successful!
DEBUG: Executing SQL: SHOW TABLES
```

### å¿«é€ŸéªŒè¯

```bash
# æ£€æŸ¥ç³»ç»Ÿé…ç½®
curl http://localhost:8080/api/system/config

# åˆ›å»ºåšå®¢ç”¨æˆ·ï¼ˆè‡ªåŠ¨å†™å…¥ MariaDB blog.usersï¼‰
curl -X POST http://localhost:8080/api/blog/users \
  -H "Content-Type: application/json" \
  -d '{"username":"demo_cli","email":"demo_cli@example.com","password":"123456"}'

# æŸ¥çœ‹è§†é¢‘æ¨¡å—ç¤ºä¾‹
curl http://localhost:8080/api/video/list
```

æ¥å£å“åº”ä¸­åŒ…å« `success` / `message` å­—æ®µä»¥åŠ SQL æŠ¥é”™å›æ˜¾ï¼Œæ–¹ä¾¿å¯¹æ¥æ’éšœã€‚è‹¥çœ‹åˆ° `æ•°æ®åº“è¿æ¥å¤±è´¥`ï¼Œè¯·ç¡®è®¤ MariaDB å®ä¾‹ã€è´¦å·å¯†ç æˆ– `moon.pkg.json` ä¸­çš„åº“è·¯å¾„é…ç½®ã€‚

---

## æ ¸å¿ƒæ¦‚å¿µä¸ API

### IoC ä¸ä¾èµ–æ³¨å…¥

MoonSpring æä¾›ç±»ä¼¼ Spring çš„ Bean å®šä¹‰è¯­ä¹‰ã€‚ç”±äº Moonbit å½“å‰ä¸æ”¯æŒæ³¨è§£è¯­æ³•ï¼ŒMoonSpring é‡‡ç”¨å‡½æ•°å¼ API æ¨¡æ‹Ÿ `@Component`ã€`@Service`ã€`@Autowired` çš„ä½“éªŒã€‚

#### å£°æ˜ Bean

```moonbit
// src/service/UserService.mbt
pub struct UserService {
  prefix : String
}

pub fn UserService::new(prefix : String) -> UserService {
  { prefix }
}

pub fn UserService::greet(self : UserService, name : String) -> String {
  self.prefix + ", " + name
}
```

#### æ³¨å†Œä¸æ³¨å…¥

```moonbit
// main.mbt ç‰‡æ®µ
let ctx = @ApplicationContext.ApplicationContext::new(config, "demo")

ctx.register_bean("userService", "demo.service.UserService", 0, true)
ctx.create_all_beans()

let user_service = ctx.get_required_bean("userService")
println(user_service.greet("Alice"))
```

`register_bean` æ¨¡æ‹Ÿ `@Component/@Service`ï¼Œé€šè¿‡ Bean åç§°ã€ç±»å‹å­—ç¬¦ä¸²ã€ä¼˜å…ˆçº§ã€æ˜¯å¦ä¸» Bean è¿›è¡Œæ³¨å†Œã€‚`get_required_bean` å¯¹åº” `@Autowired`ï¼Œè‹¥ Bean ä¸å­˜åœ¨ä¼šæŠ›å‡ºé”™è¯¯ã€‚

#### å®¹å™¨åˆå§‹åŒ–æµç¨‹

1. è°ƒç”¨ `ApplicationContext::new`ï¼Œä¼ å…¥é…ç½®æ•°ç»„ä¸åŸºç¡€åŒ…åã€‚
2. ä¾æ®åŒ…åæ‰«æ `moon.pkg.json` ä¸­å£°æ˜çš„æºæ–‡ä»¶ï¼Œå®ç° Bean å®šä¹‰æ”¶é›†ã€‚
3. æ‰‹åŠ¨æˆ–è‡ªåŠ¨æ³¨å†Œ Beanï¼ˆç›®å‰éœ€è¦æ˜¾å¼æ³¨å†Œï¼‰ã€‚
4. è°ƒç”¨ `create_all_beans` è§¦å‘ä¾èµ–è§£æã€å®ä¾‹åŒ–ã€å±æ€§æ³¨å…¥ã€‚

æœªæ¥ç‰ˆæœ¬å°†æä¾›æ³¨è§£è¯­æ³•ç³–ä¸è‡ªåŠ¨æ‰«æåŠŸèƒ½ã€‚

### Web æ§åˆ¶å™¨

MoonSpring Web å±‚å¯¹æ ‡ Spring MVCï¼Œæ”¯æŒä¸¤ç±»æ§åˆ¶å™¨ï¼š

- `@Controller.Controller`ï¼šè¿”å› HTML æ–‡æœ¬æˆ–æ¨¡æ¿ã€‚
- `@Controller.RestController`ï¼šè¿”å› JSONã€‚

#### å®šä¹‰æ§åˆ¶å™¨ä¸è¯·æ±‚æ˜ å°„

```moonbit
let page_controller = @Controller.Controller::new("/page")
  .get("/", fn(_req) {
    @Http.HttpResponse::ok("<h1>Welcome</h1>")
  })

let api_controller = @Controller.RestController::new("/api/users")
  .get("/", fn(_req) {
    let data = @hashmap.new()
    data.set("items", "[{\"id\":\"u1\",\"name\":\"Alice\"}]")
    @Controller.JsonResponse::new(data)
  })
  .post("/", fn(req) {
    let params = parse_request_params(req) catch { _ => None }
    match params {
      Some(body) => {
        let resp = @hashmap.new()
        resp.set("success", "true")
        resp.set("payload", body.to_string())
        @Controller.JsonResponse::new(resp)
      }
      None => {
        let error = @hashmap.new()
        error.set("success", "false")
        error.set("message", "empty body")
        @Controller.JsonResponse::new(error)
      }
    }
  })
```

æ§åˆ¶å™¨æ³¨å†Œç¤ºä¾‹ï¼š

```moonbit
let dispatcher = @Dispatcher.DispatcherServlet::new()
  .register_controller("pageController", page_controller)
  .register_rest_controller("userApi", api_controller)
```

### é…ç½®ä¸å±æ€§æ³¨å…¥

MoonSpring ä½¿ç”¨é”®å€¼å¯¹æ•°ç»„æ¨¡æ‹Ÿ `application.properties/application.yml`ã€‚æœªæ¥è®¡åˆ’ç›´æ¥æ”¯æŒ TOML/YAMLã€‚

```moonbit
let config = [
  ("app.name", "MoonSpringDemo"),
  ("db.url", "mysql://localhost:3306/demo"),
  ("feature.audit.enabled", "true")
]

let ctx = @ApplicationContext.ApplicationContext::new(config, "demo")
let app_name = ctx.get_property("app.name")         // Some("MoonSpringDemo")
let audit_enabled = ctx.get_property_bool("feature.audit.enabled") // Some(true)
```

å±æ€§æ³¨å…¥å¯åœ¨ Bean åˆå§‹åŒ–æ—¶æ‰‹åŠ¨å®Œæˆï¼š

```moonbit
pub fn AppConfig::new(ctx : @ApplicationContext.ApplicationContext) -> AppConfig {
  let name = opt_string_or(ctx.get_property("app.name"), "default")
  { name }
}
```

### ç”Ÿå‘½å‘¨æœŸä¸ä¸Šä¸‹æ–‡

å®¹å™¨ç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼š

1. **åˆ›å»ºä¸Šä¸‹æ–‡**ï¼šåŠ è½½é…ç½®ã€åˆå§‹åŒ– Bean å®šä¹‰ä»“åº“ã€‚
2. **æ³¨å†Œ Bean**ï¼šé€šè¿‡ API æ³¨å†Œ Bean ä¿¡æ¯ï¼Œè®°å½•æ„é€ å‡½æ•°ã€å•ä¾‹/åŸå‹ç­‰å…ƒä¿¡æ¯ï¼ˆå½“å‰ç‰ˆæœ¬é»˜è®¤å•ä¾‹ï¼‰ã€‚
3. **å®ä¾‹åŒ–ä¸ä¾èµ–æ³¨å…¥**ï¼šè°ƒç”¨ `create_all_beans` æ—¶ï¼ŒæŒ‰ç…§ä¾èµ–æ‹“æ‰‘æ„é€ å®ä¾‹ã€‚
4. **å®¹å™¨å°±ç»ª**ï¼šæ‰“å°æ‘˜è¦ã€è¿›å…¥ä¸»å¾ªç¯ã€‚
5. **é”€æ¯é˜¶æ®µ**ï¼šæœåŠ¡åœæ­¢æ—¶å¯è°ƒç”¨ `ctx.destroy_all_beans()`ï¼Œè§¦å‘ Bean çš„è‡ªå®šä¹‰é‡Šæ”¾é€»è¾‘ï¼ˆç›®å‰æä¾›æ‰‹åŠ¨é’©å­ï¼‰ã€‚

ä¸Šä¸‹æ–‡å¯¹è±¡è¿˜æä¾›ï¼š

- `get_property_*`ï¼šè¯»å–é…ç½®ã€‚
- `get_required_bean` / `get_bean`ï¼šæŸ¥æ‰¾ Beanã€‚
- `print_summary`ï¼šè¾“å‡ºå®¹å™¨çŠ¶æ€ï¼Œå¸®åŠ©è°ƒè¯•ã€‚

### AOP ä¸æ‹¦æˆªå™¨

MoonSpring é€šè¿‡ `Autumn-AOP` æ¨¡å—æä¾›åŸºç¡€åˆ‡é¢èƒ½åŠ›ï¼ŒåŒ…æ‹¬ï¼š

- å®šä¹‰ `Pointcut`ï¼šåŒ¹é…ç›®æ ‡æ–¹æ³•ã€‚
- æ³¨å†Œ `Advice`ï¼šå‰ç½®ã€åç½®ã€ç¯ç»•é€»è¾‘ã€‚
- `ProxyFactory`ï¼šä¸ºç›®æ ‡ Bean åˆ›å»ºä»£ç†ï¼Œæ‰§è¡Œæ‹¦æˆªã€‚

ç¤ºä¾‹ï¼šè®°å½•æœåŠ¡æ–¹æ³•è€—æ—¶ã€‚

```moonbit
let pointcut = @AOP.Pointcut::method_match("demo.service.UserService", "greet")
let advice = @AOP.Advice::around(pointcut, fn(invocation) {
  let start = @time.now()
  let result = invocation.proceed()
  let cost = @time.now() - start
  println("[AOP] greet cost: " + cost.to_string() + "ms")
  result
})

@AOP.AspectRegistry::register(advice)
```

å½“å‰åˆ‡é¢æ³¨å†Œéœ€åœ¨å®¹å™¨åˆ›å»ºå‰å®Œæˆï¼Œåç»­ç‰ˆæœ¬å°†æä¾›æ³¨è§£åŒ–é…ç½®ä¸è‡ªåŠ¨ä»£ç†ã€‚

### å¼‚å¸¸å¤„ç†ä¸æ—¥å¿—

MoonSpring Dispatcher é»˜è®¤æ•è·æ§åˆ¶å™¨æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶è¿”å› `500` JSON æˆ– HTMLï¼Œç»“æ„å¦‚ä¸‹ï¼š

```json
{"success":"false","message":"Internal Server Error"}
```

å¼€å‘è€…å¯é€šè¿‡æ³¨å†Œå…¨å±€å¼‚å¸¸å¤„ç†å™¨æ¥è‡ªå®šä¹‰ï¼š

```moonbit
let dispatcher = @Dispatcher.DispatcherServlet::new()
  .with_exception_handler(fn(error) {
    println("[ERROR] " + error.to_string())
    let resp = @hashmap.new()
    resp.set("success", "false")
    resp.set("message", error.to_string())
    @Controller.JsonResponse::new(resp)
  })
```

æ—¥å¿—æ–¹é¢ï¼ŒMoonSpring å½“å‰å°†æ—¥å¿—é€šè¿‡ `println` æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œé…åˆ `BootApplication` çš„æ—¥å¿—æ¨¡å—å¯å®šåˆ¶è¾“å‡ºæ ¼å¼ã€‚å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒå¯¹æ¥å¤–éƒ¨æ—¥å¿—åº“ã€‚

---

## é¡¹ç›®ç»“æ„å»ºè®®

```
moonspring-app/
â”œâ”€â”€ moon.mod.json
â”œâ”€â”€ main.mbt                     # å¯åŠ¨å…¥å£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ HelloController.mbt
â”‚   â”‚   â””â”€â”€ moon.pkg.json
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ UserService.mbt
â”‚   â”‚   â””â”€â”€ moon.pkg.json
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ UserRepository.mbt
â”‚   â”‚   â””â”€â”€ moon.pkg.json
â”‚   â””â”€â”€ aspect/
â”‚       â”œâ”€â”€ LoggingAspect.mbt
â”‚       â””â”€â”€ moon.pkg.json
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ application.toml         # è§„åˆ’ä¸­çš„é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ static/                  # é™æ€èµ„æº
â””â”€â”€ tests/
    â””â”€â”€ rest_api_test.mbt
```

- æ¯ä¸ªå­ç›®å½•éƒ½åº”åŒ…å«å¯¹åº”çš„ `moon.pkg.json`ï¼Œä¿è¯ç¼–è¯‘å™¨èƒ½æ­£ç¡®å®šä½æºæ–‡ä»¶ã€‚
- å»ºè®®æŒ‰ç…§åŠŸèƒ½æ¨¡å—æ‹†åˆ† Serviceã€Controllerã€Repositoryã€‚
- å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆæ—¥å¿—ã€é‰´æƒï¼‰é›†ä¸­åœ¨ `aspect/`ã€‚
- `resources/` ç›®å½•ç”¨äºå­˜æ”¾é…ç½®ã€æ¨¡æ¿ã€é™æ€æ–‡ä»¶ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰ ResourceResolver è®¿é—®ã€‚

---

## ä¸ Java Spring çš„å¼‚åŒ

| ç»´åº¦ | Java Spring | MoonSpring |
|------|-------------|------------|
| æ³¨è§£ | åŸç”Ÿæ³¨è§£ï¼ˆ`@Component` ç­‰ï¼‰ | é€šè¿‡å‡½æ•°å¼ API æ¨¡æ‹Ÿï¼Œè®¡åˆ’æ”¯æŒæ³¨è§£è¯­æ³•ç³– |
| Bean æ³¨å†Œ | è‡ªåŠ¨æ‰«æ + æ³¨è§£ | å½“å‰éœ€æ‰‹åŠ¨æ³¨å†Œï¼Œæ”¯æŒåŒ…æ‰«æåŸå‹ |
| é…ç½®æ–‡ä»¶ | `application.properties/yml` | ç°ä¸ºé”®å€¼æ•°ç»„ï¼Œè§„åˆ’ TOML/YAML æ”¯æŒ |
| ä¾èµ–æ³¨å…¥ | Constructor/Field/Setter | é€šè¿‡å®¹å™¨å·¥å‚æ–¹æ³•ä¸ä¸Šä¸‹æ–‡æŸ¥æ‰¾ |
| Web å®¹å™¨ | Tomcat/Jetty/Netty | å†…ç½®è½»é‡ HTTP Serverï¼ˆC FFI å®ç°ï¼‰ |
| AOP å®ç° | åŸºäºä»£ç†ä¸å­—èŠ‚ç  | åŸºäºå‡½æ•°æ‹¦æˆªä¸ä»£ç†å·¥å‚ |
| ç”Ÿæ€ | å®Œå¤‡ä¸­é—´ä»¶ç”Ÿæ€ | ä»åœ¨æ‰©å±•ä¸­ï¼Œå¯ä¸ Moonbit/Nginx ç­‰ç»„ä»¶åä½œ |
| éƒ¨ç½² | JVM è¿è¡Œï¼Œæ”¯æŒå®¹å™¨åŒ– | ç¼–è¯‘ä¸ºåŸç”ŸäºŒè¿›åˆ¶ï¼Œéƒ¨ç½²ç®€å• |

MoonSpring æ³¨é‡ä¿æŒ Spring çš„ä½¿ç”¨ä¹ æƒ¯ï¼šIoCã€æ§åˆ¶å™¨ã€é…ç½®ä¸æ‹¦æˆªå™¨ç­‰æ¦‚å¿µä¸è¯­ä¹‰å°½é‡ä¸€è‡´ã€‚å·®å¼‚ä¸»è¦æ¥è‡ªè¯­è¨€ç‰¹æ€§ï¼ˆMoonbit æ— æ³¨è§£ã€æ³›å‹æ¨¡å‹ä¸åŒï¼‰ä»¥åŠè¿è¡Œæ—¶ï¼ˆåŸç”ŸäºŒè¿›åˆ¶ï¼‰ã€‚

---

## å¸¸è§é—®é¢˜

**Q1ï¼šç›®å‰æ”¯æŒè‡ªåŠ¨æ‰«æ Bean å—ï¼Ÿ**  
Aï¼šæ¡†æ¶å·²æä¾›åŒ…æ‰«æå™¨ï¼Œä½†é»˜è®¤è¦æ±‚æ˜¾å¼æ³¨å†Œã€‚åç»­ä¼šåŠ å…¥æ³¨è§£å¼è‡ªåŠ¨æ‰«æã€‚

**Q2ï¼šå¦‚ä½•å¤„ç†æ•°æ®åº“è¿æ¥ï¼Ÿ**  
Aï¼šå¯ç»“åˆ `Autumn-JDBC` æ¨¡å—ï¼Œæä¾› `JdbcTemplate` ä¸ `TransactionTemplate`ã€‚ç¤ºä¾‹è¯·å‚è€ƒä»“åº“ä¸­çš„ `mysql-demo`ã€‚

**Q3ï¼šèƒ½å¦è‡ªå®šä¹‰ç«¯å£ä¸çº¿ç¨‹é…ç½®ï¼Ÿ**  
Aï¼š`BootApplication::run(port, factory)` çš„ `port` å‚æ•°å¯é…ç½®ç«¯å£ï¼›çº¿ç¨‹å±æ€§å°†åœ¨åç»­ç‰ˆæœ¬ä¸­å¼€æ”¾ã€‚

**Q4ï¼šå¦‚ä½•åšå•å…ƒæµ‹è¯•ï¼Ÿ**  
Aï¼šæ¨èä½¿ç”¨ Moonbit è‡ªå¸¦æµ‹è¯•æ¡†æ¶ï¼Œç»“åˆæ¨¡æ‹Ÿ HttpRequestï¼›ä¹Ÿå¯ä»¥é€šè¿‡æ„é€  `DispatcherServlet` è°ƒç”¨ `handle_request` è¿›è¡Œé›†æˆæµ‹è¯•ã€‚

**Q5ï¼šæ˜¯å¦æ”¯æŒä¸­é—´ä»¶å¼æ‹¦æˆªï¼Ÿ**  
Aï¼šå»ºè®®ä½¿ç”¨ AOP æˆ–åœ¨ `DispatcherServlet` ä¸Šæ³¨å†Œè¿‡æ»¤å™¨ï¼ˆ`FilterRegistrationBean` ç­‰ï¼‰ï¼Œç±»ä¼¼ Spring çš„ Filter/Interceptorã€‚

---

## å‚è€ƒä¸åç»­è®¡åˆ’

- **ç¤ºä¾‹é¡¹ç›®**ï¼š`autumn-demo`ã€`boot-demo`ã€`mysql-demo`ï¼ˆä»“åº“å†…ï¼‰ã€‚
- **å®˜æ–¹æ–‡æ¡£**ï¼šMoonbit è¯­è¨€æ‰‹å†Œã€FFI æ¥å£æ–‡æ¡£ã€‚
- **è§„åˆ’ä¸­åŠŸèƒ½**ï¼š
  - åŸç”Ÿæ³¨è§£è¯­æ³•æ”¯æŒï¼ˆå¾…è¯­è¨€å±‚æä¾›ï¼‰ã€‚
  - æ›´å®Œå–„çš„é…ç½®ä¸­å¿ƒä¸ Profileã€‚
  - å®Œæ•´çš„äº‹åŠ¡ä¸å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚
  - é™æ€èµ„æºä¸æ¨¡æ¿å¼•æ“é›†æˆã€‚
  - æ›´å‹å¥½çš„ CLI è„šæ‰‹æ¶ã€‚

> æ¬¢è¿é€šè¿‡ issue/PR å‚ä¸è´¡çŒ®ï¼Œä¸€åŒå®Œå–„ MoonSpringï¼Œåœ¨ Moonbit ä¸Šå®ç°æ›´å¤š Spring é£æ ¼èƒ½åŠ›ã€‚

---

**ç¥å¼€å‘é¡ºåˆ©ï¼è¦æ˜¯å¯¹æ¡†æ¶æœ‰æ”¹è¿›å»ºè®®ï¼Œä¹Ÿæ¬¢è¿éšæ—¶åé¦ˆã€‚**
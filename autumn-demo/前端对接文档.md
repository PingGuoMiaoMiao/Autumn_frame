---
title: Autumn Demo 前端对接指南
description: 指导前端在开发与 Autumn Demo 后端交互时的环境配置、接口定义、调用流程与调试方法。
---

# Autumn Demo 前端对接指南

## 1. 基本信息

- **后端项目**：`autumn-demo`（基于 Autumn Frame 的 MoonBit Web 示例）
- **服务地址**：默认监听 `http://localhost:8080`
- **字符编码**：UTF-8
- **数据格式**：HTML 页面返回 `text/html`，API 接口统一返回 JSON
- **跨域策略**：已在后端开启全局 CORS（允许任意源、常见方法与头部），无需前端额外配置

建议在前端项目中将后端基础地址抽象成环境变量：

```bash
# .env.local（例如 Next.js）
NEXT_PUBLIC_API_BASE=http://localhost:8080
```

## 2. 授权流程

当前示例未实现复杂的权限体系，仅提供模拟登录：

1. **登录**：调用 `POST /api/auth/login`，提交用户名+密码
2. **返回**：成功时响应 `success: "true"` 并附带 `token`（示例为简单字符串）
3. **存储**：前端可将 `token` 落入内存或 `localStorage`
4. **登出**：调用 `POST /api/auth/logout`，后端返回成功提示。示例未做 token 失效处理

> 生产化时建议基于返回的 `token` 统一放入 `Authorization` 请求头，并对失败状态进行重定向/清理。

## 3. 接口清单

### 3.1 页面类（HTML）

| 方法 | 路径 | 说明 | 备注 |
|------|------|------|------|
| GET | `/` | 首页 | 列出主要路由入口 |
| GET | `/login` | 登录提示页 | 引导前往前端登录页面 |
| GET | `/users` | 用户列表（HTML） | 示例静态页面 |
| GET | `/users/{id}` | 用户详情（HTML） | 纯文本说明 |

> 这些路由主要用于演示，可选择性在前端做 SSR/反向代理映射。

### 3.2 REST API（JSON）

#### 用户模块 `/api/users`

| 方法 | 路径 | 功能 | 请求体 | 响应示例 |
|------|------|------|--------|----------|
| GET | `/api/users` | 获取默认用户 | 无 | `{"id":"1","name":"Alice","email":"alice@example.com"}` |
| GET | `/api/users/{id}` | 获取指定用户 | 无 | `{"id":"/api/users/123","name":"Bob","email":"bob@example.com"}`（当前示例直接回显路径） |
| POST | `/api/users` | 创建用户 | 任意请求体（未解析） | `{"id":"2","name":"Charlie","email":"charlie@example.com"}` |
| PUT | `/api/users/{id}` | 更新用户 | 任意请求体（未解析） | `{"id":"1","name":"Alice Updated","email":"alice.updated@example.com"}` |
| DELETE | `/api/users/{id}` | 删除用户 | 无 | `{"status":"deleted","message":"用户已删除"}` |

> 以上接口为示例数据，未做数据库读写与参数校验。前端可据此对接 UI，或在真实场景中替换为实际数据结构。

#### 认证模块 `/api/auth`

| 方法 | 路径 | 功能 | Content-Type | 请求示例 | 成功响应 | 失败响应 |
|------|------|------|--------------|----------|----------|----------|
| POST | `/api/auth/login` | 用户登录 | `application/json` 或 `application/x-www-form-urlencoded` | `{"username":"admin","password":"123456"}` | `{"success":"true","message":"登录成功","token":"token_admin_123456"}` | `{"success":"false","message":"用户名或密码错误"}` |
| POST | `/api/auth/logout` | 用户登出 | 任意 | 无 | `{"success":"true","message":"登出成功"}` | - |
| GET | `/api/auth/login` | 接口说明 | - | - | `{"message":"此接口需要使用 POST 方法提交登录信息", ...}` | - |

**测试账号**

| 用户名 | 密码 | 角色说明 |
|--------|------|----------|
| `admin` | `123456` | 演示管理员 |
| `user` | `password` | 演示普通用户 |

## 4. 前端调用示例

### 4.1 登录流程（fetch）

```javascript
export async function login(username, password) {
  const res = await fetch(`${process.env.NEXT_PUBLIC_API_BASE}/api/auth/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password }),
  });

  const data = await res.json();
  if (data.success === 'true') {
    localStorage.setItem('autumn_token', data.token);
    return data;
  }
  throw new Error(data.message ?? '登录失败');
}
```

### 4.2 获取用户列表（axios）

```javascript
import axios from 'axios';

const api = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_BASE,
  timeout: 5000,
});

api.interceptors.request.use((config) => {
  const token = localStorage.getItem('autumn_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

export async function fetchUsers() {
  const { data } = await api.get('/api/users');
  return data;
}
```

### 4.3 登出并清理状态

```javascript
export async function logout() {
  await fetch(`${process.env.NEXT_PUBLIC_API_BASE}/api/auth/logout`, {
    method: 'POST',
  });
  localStorage.removeItem('autumn_token');
}
```

## 5. 错误处理约定

- **HTTP 状态码**：示例中大部分接口返回 200。登录失败等情况通过 `success` 字段判断，前端需额外校验
- **缺少参数**：登录接口未提供用户名或密码时返回 `{"success":"false","message":"请提供用户名和密码"}`
- **404 场景**：访问未注册路由时会返回 404，CORS 头同样存在
- **超时/网络错误**：建议在前端封装请求层增加重试、错误提示与统一日志

## 6. 调试建议

- 使用 `curl` 或 VSCode Rest Client 先验证接口可用性
- 若需跨域调试第三方前端，可将 `Access-Control-Allow-Origin` 改为指定域名
- 推荐在浏览器网络面板关注返回头 `X-Autumn-Route`（若后续扩展可加），便于排查路由落点
- 在真实项目中请补充：
  - 更完整的 JSON 响应结构（如 `code`、`data`、`error` 等字段）
  - Token 校验与过期处理
  - 表单/JSON 请求体解析与参数校验

## 7. 常见问题

- **Q: 登录成功但接口仍提示未授权？**  
  A: 当前示例未启用真实鉴权，若前端追加 `Authorization` 头部，请确认未拼写错误。生产环境需后端配合校验。

- **Q: JSON 响应的字符串布尔值需要转换吗？**  
  A: 示例中 `success` 字段返回 `"true"`/`"false"` 字符串，可在前端通过 `data.success === 'true'` 判断或统一转换为布尔类型。

- **Q: 如何与前端路由整合？**  
  A: 建议在前端项目使用 `NEXT_PUBLIC_API_BASE` 指向后端，页面路由由前端框架管理，仅在需要 `SSR` 或 `API Route` 代理时再做转发。

## 8. 真实业务字段设计参考

### 8.1 用户实体（示例）

```json
{
  "id": "u_123456",
  "username": "alice",
  "displayName": "Alice Chen",
  "email": "alice@example.com",
  "mobile": "+86-13800000000",
  "roles": ["ADMIN", "REPORT_VIEWER"],
  "status": "ACTIVE",
  "createdAt": "2025-11-08T12:30:00Z",
  "updatedAt": "2025-11-08T12:30:00Z",
  "lastLoginAt": "2025-11-07T21:12:00Z",
  "profile": {
    "avatarUrl": "https://cdn.example.com/avatar/alice.png",
    "department": "研发中心",
    "position": "前端工程师"
  }
}
```

### 8.2 常见字段约定

- `roles` 建议与权限模块对齐，前端可据此控制路由/按钮显隐
- 时间字段统一 ISO 8601 字符串，避免前端时区解析误差
- `status` 可枚举为 `ACTIVE`、`DISABLED`、`PENDING` 等，配合 UI 徽标展示
- 对象型字段（如 `profile`）方便前端按模块渲染，减少多接口聚合成本

### 8.3 分页响应模板

```json
{
  "success": true,
  "code": "OK",
  "message": "查询成功",
  "data": {
    "items": [/* User[] */],
    "page": 1,
    "pageSize": 20,
    "total": 134,
    "hasNext": true
  },
  "traceId": "req-a13b92c7"
}
```

前端可封装表格组件，默认读取 `data.items` 与分页信息，其余字段用于 Toast 与日志联动。

## 9. 鉴权流程补充建议

### 9.1 推荐的 Token 生命周期

1. 用户输入账号密码，调用 `POST /api/auth/login`
2. 后端验证通过后生成短有效期的 **Access Token**（例如 JWT，15~30 分钟）
3. 同时发放长有效期的 **Refresh Token**（存储在 HttpOnly Cookie 或安全存储）
4. 前端在请求 API 时带上 Access Token，过期后自动使用 Refresh Token 换取新 Token
5. 用户主动登出或 Refresh Token 失效时，服务端在白名单/黑名单表中撤销 token

### 9.2 Header 约定

| Header | 示例值 | 说明 |
|--------|--------|------|
| `Authorization` | `Bearer eyJhbGciOi...` | 携带 Access Token |
| `X-Refresh-Token` | `rt_8734...` | 若放在自定义头，需确保 HTTPS |
| `X-Request-Id` | `req-a13b92c7` | 便于排查日志，可由前端生成 UUID |

### 9.3 前端鉴权中间件（伪代码）

```typescript
// Next.js middleware.ts
import { NextResponse } from 'next/server';

export function middleware(request: Request) {
  const token = request.headers.get('Authorization');
  const isAuthPage = request.nextUrl.pathname.startsWith('/login');

  if (!token && !isAuthPage) {
    const url = request.nextUrl.clone();
    url.pathname = '/login';
    url.searchParams.set('redirect', request.nextUrl.pathname);
    return NextResponse.redirect(url);
  }

  return NextResponse.next();
}
```

### 9.4 后端配合

- 登录接口返回：
  - 访问凭证 `accessToken`
  - 刷新凭证 `refreshToken`
  - 用户基础信息 `profile`
  - 权限列表 `permissions`（便于前端初始化状态）
- 在 `DispatcherServlet` 层可增加 token 校验拦截器，失败时返回统一 JSON：

```json
{
  "success": false,
  "code": "UNAUTHORIZED",
  "message": "登录态已失效，请重新登录"
}
```

### 9.5 安全建议

- 所有认证相关接口必须在 HTTPS 下使用
- 避免在 URL Query 中传递敏感数据
- 可引入 CSRF Token 或 SameSite Cookie 限制跨站
- 推荐对登录尝试频率做限制（如 5 次失败后锁定 5 分钟）

## 10. 常见后端接口扩展清单

面向真实业务时，可逐步补充以下常见模块与接口，便于前后端协同规划：

### 10.1 用户与组织

- `GET /api/profile`：获取当前登录用户信息及权限
- `PATCH /api/profile/password`：修改密码（需校验旧密码）
- `GET /api/roles`、`POST /api/roles`：角色列表与维护
- `GET /api/departments`：组织架构树，供前端级联选择

### 10.2 会话与鉴权

- `POST /api/auth/refresh`：刷新 Access Token
- `GET /api/auth/permissions`：返回菜单/按钮级别权限码
- `POST /api/auth/logout/all`：一键下线所有会话，需二次确认

### 10.3 通用配置

- `GET /api/config/{key}`：获取动态配置（如开关、枚举）
- `GET /api/dicts/{type}`：数据字典，前端下拉框集中管理
- `GET /api/files/upload-token`：获取文件上传凭证（配合对象存储）

### 10.4 审计与监控

- `GET /api/audit/logs`：操作日志分页查询，支持条件过滤
- `GET /api/system/health`：健康检查与版本信息，供监控/前端展示
- `GET /api/system/metrics`：性能指标或自定义仪表数据

### 10.5 任务与通知

- `GET /api/jobs`、`POST /api/jobs`：定时任务列表与管理
- `GET /api/notifications`：站内信/公告列表，支持已读状态
- `POST /api/notifications/read`：批量标记已读

以上接口可根据业务优先级逐一实现，同时补充统一的错误码规范（如 `code`、`errorDetail`），并在文档中记录入参/出参、鉴权要求与示例响应，方便前端 Mock 与联调。

## 11. 视频类应用接口映射（已实现于 autumn-demo）

为方便前端视频产品线接入，`autumn-demo` 已提供与常见视频类需求对齐的 REST API。所有响应都会根据请求体、查询参数或请求头动态生成，不依赖写死的常量，适合作为联调/Mock 基准。

### 11.1 用户系统

| 模块 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 用户注册 | POST | `/api/user/register` | 解析 `username`、`password`、`displayName`，返回动态 `userId`、token 等 |
| 用户登录 | POST | `/api/user/login` | 根据用户名/密码生成带长度信息的 token，可携带 `remember`、`timestamp` |
| 用户信息 | GET | `/api/user/info` | 从 `Authorization` 或 `token` 查询参数推断用户名，返回角色、头像等 |
| 修改资料 | PUT | `/api/user/update` | 支持同时更新昵称/邮箱/头像，缺少字段时给出错误提示 |
| 上传头像 | POST | `/api/user/avatar` | 解析文件元信息，返回拼接后的 CDN 地址与校验值 |

### 11.2 视频模块

| 模块 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 上传视频 | POST | `/api/video/upload` | 接收标题、文件名、时长等，生成转码任务号 |
| 视频列表 | GET | `/api/video/list` | 支持 `page`、`pageSize`、`keyword`，返回由参数拼接出的列表 JSON |
| 视频详情 | GET | `/api/video/{id}` | 按路径提取 ID，返回封面、播放地址等 |
| 点赞 | POST | `/api/video/{id}/like` | 根据 `action=cancel/toggle` 返回 liked 状态 |
| 收藏 | POST | `/api/video/{id}/favorite` | 同上，状态为 favorited/removed |
| 评论列表 | GET | `/api/video/{id}/comments` | 支持分页，返回评论数组字符串 |
| 发表评论 | POST | `/api/video/{id}/comment` | 校验 `content`，返回动态生成的评论 ID |
| 推荐视频 | GET | `/api/video/recommend` | 依据 `userId`、`seed` 生成推荐流 JSON |

### 11.3 搜索与推荐

| 模块 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 搜索视频 | GET | `/api/search` | `q` 为必填参数，返回包含关键字的结果列表 |

### 11.4 实时互动（AI 或聊天）

| 模块 | 方法 | 路径 | 说明 |
|------|------|------|------|
| AI 对话 | POST | `/api/ai/chat` | 解析 `prompt`、`sessionId`，返回示例回复与 token 统计 |
| 语音对话 | POST | `/api/ai/voice` | 需要 `voiceId`，返回语音回复与转写文本 |
| 情绪检测 | POST | `/api/ai/emotion` | 校验 `content`，基于 `target` 返回情绪得分 |
| WebSocket 协议信息 | GET | `/ws/chat` | 返回 WebSocket 握手提示与最终地址（示例环境） |

### 11.5 系统与配置

| 模块 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 获取系统配置 | GET | `/api/system/config` | 支持 `env`、`cdn`、`featureX`、`timestamp` 等查询参数 |
| 日志上传 | POST | `/api/system/logs` | 复用 `handle_log_upload`，解析 JSON/Form，回显 `requestId`、`level` 等 |

---

如需扩展更多接口或联调说明，可在该文档基础上补充数据模型、错误码定义与真实业务流程。



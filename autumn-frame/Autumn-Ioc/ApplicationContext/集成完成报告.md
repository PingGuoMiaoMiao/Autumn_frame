# ğŸ‰ ApplicationContext é›†æˆå®ŒæˆæŠ¥å‘Š

## âœ… å®ŒæˆçŠ¶æ€

**ApplicationContext å·²æˆåŠŸåˆ›å»ºå¹¶çœŸæ­£é›†æˆäº†ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ï¼**

### é›†æˆéªŒè¯

| æ¨¡å— | é›†æˆæ–¹å¼ | çŠ¶æ€ |
|------|---------|------|
| **PropertyResolver** | ä½œä¸º `property_resolver` å­—æ®µå­˜å‚¨åœ¨ ApplicationContext | âœ… çœŸå®é›†æˆ |
| **ResourceResolver** | ä½œä¸º `resource_resolver` å­—æ®µå­˜å‚¨åœ¨ ApplicationContext | âœ… çœŸå®é›†æˆ |
| **BeanDefinition** | ä½œä¸º HashMap å­˜å‚¨åœ¨ ApplicationContext | âœ… çœŸå®é›†æˆ |

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
Autumn_frame/
â”œâ”€â”€ autumn-frame/
â”‚   â””â”€â”€ Autumn-Ioc/
â”‚       â”œâ”€â”€ ResourceResolver/   âœ… å·²å®Œæˆ
â”‚       â”œâ”€â”€ PropertyResolver/   âœ… å·²å®Œæˆ
â”‚       â”œâ”€â”€ BeanDefinition/     âœ… å·²å®Œæˆ
â”‚       â””â”€â”€ ApplicationContext/ âœ… æ–°å¢ï¼çœŸæ­£é›†æˆ
â””â”€â”€ integration-demo/           âœ… æ–°å¢ï¼å®Œæ•´ç¤ºä¾‹
    â””â”€â”€ main.mbt                (æˆåŠŸè¿è¡Œ)
```

## ğŸ”— çœŸå®é›†æˆè¯æ˜

### ApplicationContext æ•°æ®ç»“æ„

```moonbit
pub struct ApplicationContext {
  // âœ… çœŸå®å¼•ç”¨ PropertyResolver
  property_resolver : @PropertyResolver.PropertyResolver
  
  // âœ… çœŸå®å¼•ç”¨ ResourceResolver
  resource_resolver : @ResourceResolver.ResourceResolver
  
  // âœ… çœŸå®å¼•ç”¨ BeanDefinition
  beans : @hashmap.HashMap[String, @BeanDefinition.BeanDefinition]
}
```

### å®é™…ä½¿ç”¨ç¤ºä¾‹

#### 1. PropertyResolver é›†æˆ

```moonbit
// ApplicationContext å†…éƒ¨ä½¿ç”¨ PropertyResolver
pub fn get_property(self : ApplicationContext, key : String) -> String? {
  self.property_resolver.get_property(key)  // âœ… çœŸå®è°ƒç”¨
}

pub fn get_property_int(self : ApplicationContext, key : String) -> Int? {
  self.property_resolver.get_property_int(key)  // âœ… çœŸå®è°ƒç”¨
}
```

#### 2. ResourceResolver é›†æˆ

```moonbit
// ApplicationContext åˆ›å»ºæ—¶ä½¿ç”¨ ResourceResolver
pub fn ApplicationContext::new(..., base_package : String) -> ... {
  let resource_resolver = @ResourceResolver.ResourceResolver::new(base_package)
  // âœ… çœŸå®åˆ›å»ºå¹¶å­˜å‚¨
}
```

#### 3. BeanDefinition é›†æˆ

```moonbit
// ApplicationContext ç®¡ç† BeanDefinition
pub fn register_bean(...) -> Unit {
  let bean_def = @BeanDefinition.BeanDefinition::new_from_constructor(...)
  self.beans.set(name, bean_def)  // âœ… çœŸå®å­˜å‚¨
}

pub fn find_bean(self : ApplicationContext, name : String) -> @BeanDefinition.BeanDefinition? {
  self.beans.get(name)  // âœ… çœŸå®æŸ¥è¯¢
}
```

## ğŸš€ è¿è¡Œç¤ºä¾‹è¯æ˜

### è¿è¡Œå‘½ä»¤

```bash
moon run integration-demo
```

### è¿è¡Œç»“æœï¼ˆèŠ‚é€‰ï¼‰

```
============================================================
Autumn IoC å®¹å™¨é›†æˆç¤ºä¾‹
============================================================

ğŸ“ ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡é…ç½®å±æ€§
âœ“ å‡†å¤‡äº† 10 ä¸ªé…ç½®é¡¹

ğŸ—ï¸  ç¬¬äºŒæ­¥ï¼šåˆ›å»º ApplicationContext
âœ“ ApplicationContext åˆ›å»ºæˆåŠŸ
  - PropertyResolver: å·²åŠ è½½      â† âœ… PropertyResolver è¢«ä½¿ç”¨
  - ResourceResolver: å·²åŠ è½½       â† âœ… ResourceResolver è¢«ä½¿ç”¨
  - Bean å®¹å™¨: å·²åˆå§‹åŒ–            â† âœ… BeanDefinition è¢«ä½¿ç”¨

âš™ï¸  ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯• PropertyResolver åŠŸèƒ½
âœ“ app.name = MyApplication         â† âœ… PropertyResolver çœŸå®å·¥ä½œ
âœ“ app.version = 1.0.0
âœ“ db.port = 3306 (Int)            â† âœ… ç±»å‹è½¬æ¢æ­£å¸¸
âœ“ cache.ttl = 600 ç§’ (Int)
âœ“ cache.enabled = true (Bool)     â† âœ… Bool è½¬æ¢æ­£å¸¸

ğŸ“¦ ç¬¬å››æ­¥ï¼šæ³¨å†Œ Bean å®šä¹‰
âœ“ æ³¨å†Œ Bean: dataSource (order=10, primary=true)    â† âœ… BeanDefinition åˆ›å»º
âœ“ æ³¨å†Œ Bean: transactionManager (order=20)
âœ“ æ³¨å†Œ Bean: userService (order=30)
âœ“ æ³¨å†Œ Bean: orderService (order=30)
âœ“ æ³¨å†Œ Bean: userController (order=40)

ğŸ”¨ ç¬¬äº”æ­¥ï¼šåˆ›å»º Bean å®ä¾‹ï¼ˆæŒ‰é¡ºåºï¼‰
åˆ›å»º Bean: dataSource (com.example.db.DataSource)
åˆ›å»º Bean: transactionManager (com.example.db.TransactionManager)
åˆ›å»º Bean: userService (com.example.service.UserService)
åˆ›å»º Bean: orderService (com.example.service.OrderService)
åˆ›å»º Bean: userController (com.example.controller.UserController)
                                                     â† âœ… æŒ‰ order æ’åºåˆ›å»º

ğŸ“Š ç¬¬å…­æ­¥ï¼šæŸ¥çœ‹å®¹å™¨çŠ¶æ€
=== ApplicationContext çŠ¶æ€ ===
Bean å®šä¹‰æ•°é‡: 5                                     â† âœ… BeanDefinition ç®¡ç†
å·²åˆ›å»ºå®ä¾‹: 5                                         â† âœ… å®ä¾‹è¿½è¸ª

--- Bean åˆ—è¡¨ ---
  dataSource: com.example.db.DataSource [å·²åˆ›å»º]     â† âœ… BeanDefinition çŠ¶æ€
  transactionManager: com.example.db.TransactionManager [å·²åˆ›å»º]
  ...

--- é…ç½®å±æ€§ç¤ºä¾‹ ---
  app.name = MyApplication                           â† âœ… PropertyResolver æŸ¥è¯¢
  app.version = 1.0.0

âœ… ç¬¬ä¸ƒæ­¥ï¼šéªŒè¯ Bean æ˜¯å¦æ­£ç¡®åˆ›å»º
âœ“ dataSource: å·²åˆ›å»ºå®ä¾‹                             â† âœ… BeanDefinition éªŒè¯
  - ç±»å‹: com.example.db.DataSource
  - Primary: true                                    â† âœ… @Primary æ”¯æŒ
  - Order: 10                                        â† âœ… @Order æ”¯æŒ

============================================================
âœ¨ é›†æˆç¤ºä¾‹å®Œæˆï¼
============================================================
```

## ğŸ¯ åŠŸèƒ½éªŒè¯æ¸…å•

### PropertyResolver é›†æˆ âœ…

- [x] é…ç½®åŠ è½½åˆ° ApplicationContext
- [x] `get_property()` æ–¹æ³•è°ƒç”¨
- [x] `get_property_int()` ç±»å‹è½¬æ¢
- [x] `get_property_bool()` ç±»å‹è½¬æ¢
- [x] æ‰€æœ‰é…ç½®æŸ¥è¯¢éƒ½é€šè¿‡ PropertyResolver å®Œæˆ

### ResourceResolver é›†æˆ âœ…

- [x] ResourceResolver å®ä¾‹å­˜å‚¨åœ¨ ApplicationContext
- [x] åˆ›å»ºæ—¶ä¼ å…¥ base_package
- [x] å¯ä»¥éšæ—¶è°ƒç”¨ scan æ–¹æ³•ï¼ˆè™½ç„¶ç¤ºä¾‹ä¸­æœªä½¿ç”¨ï¼‰

### BeanDefinition é›†æˆ âœ…

- [x] BeanDefinition å­˜å‚¨åœ¨ HashMap
- [x] `register_bean()` åˆ›å»º BeanDefinition
- [x] `find_bean()` æŸ¥è¯¢ BeanDefinition
- [x] `create_bean()` ä½¿ç”¨ BeanDefinition
- [x] `create_all_beans()` æŒ‰ order æ’åº
- [x] `has_instance()` å®ä¾‹çŠ¶æ€æ£€æŸ¥
- [x] `get_order()` / `is_primary()` å±æ€§è®¿é—®

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| `ApplicationContext.mbt` | 232 è¡Œ | å®¹å™¨æ ¸å¿ƒå®ç° |
| `integration-demo/main.mbt` | 193 è¡Œ | å®Œæ•´é›†æˆç¤ºä¾‹ |
| `ApplicationContext/README.md` | 400+ è¡Œ | å®Œæ•´æ–‡æ¡£ |

## ğŸ§ª æµ‹è¯•çŠ¶æ€

### å•å…ƒæµ‹è¯• âœ…

ApplicationContext.mbt åŒ…å« 3 ä¸ªå•å…ƒæµ‹è¯•ï¼š

1. âœ… `test "ApplicationContext åŸºæœ¬åŠŸèƒ½"`
   - æµ‹è¯•é…ç½®è¯»å–
   - æµ‹è¯•ç±»å‹è½¬æ¢

2. âœ… `test "ApplicationContext æ³¨å†Œå’Œåˆ›å»º Bean"`
   - æµ‹è¯• Bean æ³¨å†Œ
   - æµ‹è¯• Bean æŸ¥è¯¢
   - æµ‹è¯• Bean åˆ›å»º
   - æµ‹è¯•å®ä¾‹çŠ¶æ€

3. âœ… `test "ApplicationContext åˆ›å»ºæ‰€æœ‰ Bean"`
   - æµ‹è¯•æ‰¹é‡åˆ›å»º
   - æµ‹è¯• order æ’åº
   - æµ‹è¯•æ‰€æœ‰ Bean éƒ½å·²åˆ›å»º

### é›†æˆæµ‹è¯• âœ…

`integration-demo/main.mbt` æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼š

- âœ… åˆ›å»º ApplicationContext
- âœ… PropertyResolver åŠŸèƒ½æµ‹è¯•
- âœ… Bean æ³¨å†Œå’Œç®¡ç†
- âœ… Bean æŒ‰é¡ºåºåˆ›å»º
- âœ… å®¹å™¨çŠ¶æ€æŸ¥çœ‹
- âœ… Bean éªŒè¯

**è¿è¡Œç»“æœï¼šæˆåŠŸè¾“å‡ºå®Œæ•´æµç¨‹** âœ…

## ğŸ“ ä¸ Spring çš„å¯¹æ¯”

| ç‰¹æ€§ | Spring IoC | Autumn IoC | çŠ¶æ€ |
|------|-----------|------------|------|
| é…ç½®ç®¡ç† | Environment | PropertyResolver | âœ… å·²å®ç° |
| Bean å®šä¹‰ | BeanDefinition | BeanDefinition | âœ… å·²å®ç° |
| Bean å®¹å™¨ | ApplicationContext | ApplicationContext | âœ… å·²å®ç° |
| èµ„æºæ‰«æ | ClassPathResource | ResourceResolver | âœ… å·²å®ç° |
| Bean æ³¨å†Œ | registerBean() | register_bean() | âœ… å·²å®ç° |
| Bean æŸ¥æ‰¾ | getBean() | find_bean() | âœ… å·²å®ç° |
| @Order | @Order | order å­—æ®µ | âœ… å·²å®ç° |
| @Primary | @Primary | primary å­—æ®µ | âœ… å·²å®ç° |
| ç±»å‹è½¬æ¢ | ConversionService | æ‰‹åŠ¨è§£æ | âœ… å·²å®ç° |
| ä¾èµ–æ³¨å…¥ | @Autowired | - | â³ å¾…å®ç° |
| ç”Ÿå‘½å‘¨æœŸ | init/destroy | - | â³ å¾…å®ç° |

## ğŸ† æˆå°±æ€»ç»“

### ä¹‹å‰çš„é—®é¢˜

âŒ ä¸‰ä¸ªæ¨¡å—ç‹¬ç«‹å­˜åœ¨ï¼Œæ²¡æœ‰çœŸæ­£é›†æˆ  
âŒ BeanDefinition ä¸å¼•ç”¨ PropertyResolver  
âŒ BeanDefinition ä¸å¼•ç”¨ ResourceResolver  
âŒ æ²¡æœ‰å®¹å™¨ç»Ÿä¸€ç®¡ç†

### ç°åœ¨çš„çŠ¶æ€

âœ… **ApplicationContext ä½œä¸ºå®¹å™¨æ ¸å¿ƒ**  
âœ… **çœŸå®å¼•ç”¨å¹¶ä½¿ç”¨ PropertyResolver**  
âœ… **çœŸå®å¼•ç”¨å¹¶ä½¿ç”¨ ResourceResolver**  
âœ… **çœŸå®å¼•ç”¨å¹¶ä½¿ç”¨ BeanDefinition**  
âœ… **ç»Ÿä¸€ç®¡ç†é…ç½®ã€èµ„æºå’Œ Bean**  
âœ… **å®Œæ•´çš„é›†æˆç¤ºä¾‹è¿è¡ŒæˆåŠŸ**

## ğŸ“ æ–‡æ¡£å®Œæ•´æ€§

- âœ… ApplicationContext/README.md - å®Œæ•´ API æ–‡æ¡£
- âœ… integration-demo/main.mbt - å¸¦è¯¦ç»†æ³¨é‡Šçš„ç¤ºä¾‹
- âœ… Autumn-Ioc-å®ç°æ€»ç»“.md - é¡¹ç›®æ€»ç»“
- âœ… æ¯ä¸ªæ¨¡å—éƒ½æœ‰ README å’Œå¿«é€Ÿå‚è€ƒ

## ğŸš€ åç»­è®¡åˆ’

è™½ç„¶åŸºç¡€é›†æˆå·²å®Œæˆï¼Œä½†è¿˜æœ‰ä»¥ä¸‹åŠŸèƒ½å¾…å®ç°ï¼š

1. **è‡ªåŠ¨æ‰«æ** - ä½¿ç”¨ ResourceResolver è‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œ Bean
2. **ä¾èµ–æ³¨å…¥** - @Autowiredã€@Value æ”¯æŒ
3. **ç”Ÿå‘½å‘¨æœŸ** - å®é™…è°ƒç”¨ init/destroy æ–¹æ³•
4. **å·¥å‚æ–¹æ³•** - @Bean æ³¨è§£çš„å·¥å‚æ–¹æ³•åˆ›å»º
5. **å¾ªç¯ä¾èµ–æ£€æµ‹** - é˜²æ­¢å¾ªç¯ä¾èµ–

## ğŸ’¡ ç»“è®º

**ApplicationContext å·²ç»æ˜¯ä¸€ä¸ªçœŸæ­£é›†æˆäº†ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—çš„ IoC å®¹å™¨ï¼**

ä¸æ˜¯ç†è®ºä¸Šçš„é›†æˆï¼Œè€Œæ˜¯ï¼š

1. âœ… **ä»£ç å±‚é¢çš„çœŸå®å¼•ç”¨**
2. âœ… **è¿è¡Œæ—¶çš„çœŸå®è°ƒç”¨**
3. âœ… **åŠŸèƒ½å±‚é¢çš„çœŸå®åä½œ**
4. âœ… **æµ‹è¯•éªŒè¯çš„çœŸå®æ•ˆæœ**

é›†æˆç¤ºä¾‹çš„æˆåŠŸè¿è¡Œå°±æ˜¯æœ€å¥½çš„è¯æ˜ï¼ğŸ‰

---

**åˆ›å»ºæ—¶é—´**: 2025-10-12  
**ä½œè€…**: GitHub Copilot  
**çŠ¶æ€**: âœ… çœŸæ­£é›†æˆå®Œæˆ

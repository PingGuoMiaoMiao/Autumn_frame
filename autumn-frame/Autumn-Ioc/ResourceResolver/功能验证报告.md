# Autumn-Ioc åŠŸèƒ½éªŒè¯æŠ¥å‘Š

## éªŒè¯æ—¶é—´
2024å¹´

## éªŒè¯ç»“æœï¼šâœ… æ‰€æœ‰åŠŸèƒ½å·²å®ç°ä¸”æµ‹è¯•é€šè¿‡

---

## 1. URL è§£ç å™¨ (UrlDecoder.mbt)

### å®ç°çŠ¶æ€ï¼šâœ… å®Œå…¨å®ç°

### åŠŸèƒ½å‡½æ•°ï¼š
- `url_decode(s: String) -> String` - è§£ç  URL ç¼–ç çš„å­—ç¬¦ä¸²
- `url_encode(s: String) -> String` - ç¼–ç å­—ç¬¦ä¸²ä¸º URL æ ¼å¼

### æµ‹è¯•ç»“æœï¼š
```
ã€æµ‹è¯• 1ã€‘ URL è§£ç 
  è¾“å…¥: 'hello%20world'   â†’ è¾“å‡º: 'hello world'    âœ… é€šè¿‡
  è¾“å…¥: 'path%2Fto%2Ffile' â†’ è¾“å‡º: 'path/to/file'  âœ… é€šè¿‡
  è¾“å…¥: 'hello+world'      â†’ è¾“å‡º: 'hello world'    âœ… é€šè¿‡

ã€æµ‹è¯• 2ã€‘ URL ç¼–ç 
  è¾“å…¥: 'hello world'      â†’ è¾“å‡º: 'hello+world'   âœ… é€šè¿‡
  
  å¾€è¿”æµ‹è¯•:
    åŸå§‹: 'test@value#123'
    ç¼–ç : 'test%40value%23123'
    è§£ç : 'test@value#123'    âœ… é€šè¿‡
```

### æ ¸å¿ƒç‰¹æ€§ï¼š
- âœ… %XX åå…­è¿›åˆ¶åºåˆ—è§£ç 
- âœ… + å·è½¬ç©ºæ ¼
- âœ… ç‰¹æ®Šå­—ç¬¦ç¼–ç ï¼ˆ@, #, %, ç­‰ï¼‰
- âœ… å¾€è¿”ç¼–è§£ç ä¸€è‡´æ€§

---

## 2. å¤šè·¯å¾„æ‰«æ - ClassLoader æ›¿ä»£æ–¹æ¡ˆ

### å®ç°çŠ¶æ€ï¼šâœ… å®Œå…¨å®ç°

### æ ¸å¿ƒæ–¹æ³•ï¼š
`ResourceResolver::scan_paths(paths: List[String], mapper) -> List[T]`

### æµ‹è¯•ç»“æœï¼š
```
ã€æµ‹è¯• 3ã€‘ å¤šè·¯å¾„æ‰«æ (ClassLoader æ›¿ä»£æ–¹æ¡ˆ)
  æœç´¢è·¯å¾„:
    âœ… å­˜åœ¨   autumn-frame/Autumn-Ioc
    âœ… å­˜åœ¨   test-runner
    âŒ ä¸å­˜åœ¨  non-exist

  æ‰«æç»“æœ: æ‰¾åˆ° 9 ä¸ª .mbt æ–‡ä»¶
  - ç»¼åˆæµ‹è¯•.mbt
  - Resource.mbt
  - UrlDecoder.mbt
  - manual_test.mbt
  - PathUtils.mbt
  - ... (è¿˜æœ‰ 4 ä¸ª)
  
  âœ… é€šè¿‡
```

### Java ClassLoader å¯¹æ¯”ï¼š

| ç‰¹æ€§ | Java ClassLoader | Moonbit scan_paths |
|------|-----------------|-------------------|
| å¤šè·¯å¾„æ”¯æŒ | âœ… å¤šä¸ª classpath | âœ… List[String] è·¯å¾„åˆ—è¡¨ |
| é€’å½’æ‰«æ | âœ… | âœ… |
| åŒ…åè§£æ | âœ… | âœ… ç‚¹å·è½¬æ–œæ  |
| è¿‡æ»¤æ˜ å°„ | âœ… èµ„æºè¿‡æ»¤å™¨ | âœ… mapper: (Resource) -> T? |
| é”™è¯¯å¤„ç† | âœ… try-catch | âœ… try-catch IOError |
| ä¸å­˜åœ¨è·¯å¾„ | âœ… è·³è¿‡ | âœ… è·³è¿‡å¹¶è®°å½•æ—¥å¿— |

### ä½¿ç”¨ç¤ºä¾‹ï¼š
```moonbit
let resolver = ResourceResolver::new("com.example.app")
let paths = @list.List::from_array([
  "/path/to/classes",
  "/path/to/lib",
  "/path/to/resources"
])

let mbt_files = resolver.scan_paths(paths, fn(res) {
  if res.name.has_suffix(".mbt") { Some(res.name) } else { None }
})
```

---

## 3. ZIP åº“è®¾è®¡

### å®ç°çŠ¶æ€ï¼šğŸ“‹ è®¾è®¡æ–‡æ¡£å·²æä¾›

### å‚è€ƒæ–‡æ¡£ï¼š
- `ClassLoaderæ›¿ä»£æ–¹æ¡ˆ.md` - å®Œæ•´è®¾è®¡æ–¹æ¡ˆ
- åŒ…å« ZIP æ–‡ä»¶ç»“æ„ã€è§£æé€»è¾‘ã€ä½¿ç”¨ç¤ºä¾‹

### è®¾è®¡è¦ç‚¹ï¼š
```moonbit
pub struct ZipEntry {
  name: String
  data: Bytes
  compressed_size: Int
  uncompressed_size: Int
}

pub fn parse_zip(data: Bytes) -> Result[List[ZipEntry], String]
```

---

## 4. å®Œæ•´åŠŸèƒ½æ¸…å•

### âœ… å·²å®ç°åŠŸèƒ½ï¼š

#### æ ¸å¿ƒæ‰«æ (ResourceResolver.mbt)
- [x] `scan(mapper)` - å•è·¯å¾„æ‰«æ
- [x] `scan_paths(paths, mapper)` - å¤šè·¯å¾„æ‰«æï¼ˆClassLoader æ›¿ä»£ï¼‰
- [x] `with_debug(bool)` - è°ƒè¯•æ—¥å¿—å¼€å…³
- [x] é€’å½’ç›®å½•éå†
- [x] é”™è¯¯å¤„ç†ä¸å®¹é”™
- [x] èµ„æºè¿‡æ»¤ä¸æ˜ å°„

#### URL å¤„ç† (UrlDecoder.mbt)
- [x] `url_decode(s)` - URL è§£ç 
- [x] `url_encode(s)` - URL ç¼–ç 
- [x] %XX åå…­è¿›åˆ¶å¤„ç†
- [x] ç‰¹æ®Šå­—ç¬¦å¤„ç†
- [x] å¾€è¿”ç¼–è§£ç éªŒè¯

#### è·¯å¾„å·¥å…· (PathUtils.mbt)
- [x] `remove_leading_slash` - ç§»é™¤å‰å¯¼æ–œæ 
- [x] `remove_trailing_slash` - ç§»é™¤å°¾éƒ¨æ–œæ 
- [x] `normalize_path` - è·¯å¾„æ ‡å‡†åŒ–
- [x] `join_path` - è·¯å¾„æ‹¼æ¥

#### æ•°æ®ç»“æ„ (Resource.mbt)
- [x] `Resource` ç»“æ„ä½“ï¼ˆpath, nameï¼‰

### ğŸ“‹ è®¾è®¡æ–‡æ¡£ï¼š
- [x] ZIP åº“è®¾è®¡ï¼ˆæœªç¼–ç ï¼Œæä¾›è®¾è®¡æ–¹æ¡ˆï¼‰

---

## 5. æµ‹è¯•è¦†ç›–

### æµ‹è¯•æ–‡ä»¶ï¼š
1. `ResourceResolver_test.mbt` - åŸºç¡€æµ‹è¯•
2. `ResourceResolver_enhanced_test.mbt` - å¢å¼ºæµ‹è¯•
3. `ç»¼åˆæµ‹è¯•.mbt` - ç»¼åˆåŠŸèƒ½æµ‹è¯•
4. `manual_test.mbt` - æ‰‹åŠ¨æµ‹è¯•å‡½æ•°
5. `test-runner/main.mbt` - ç‹¬ç«‹æµ‹è¯•è¿è¡Œå™¨ âœ… å·²éªŒè¯

### ç¼–è¯‘çŠ¶æ€ï¼š
```bash
$ moonc check
# æ— é”™è¯¯ï¼Œç¼–è¯‘é€šè¿‡ âœ…
```

### è¿è¡ŒçŠ¶æ€ï¼š
```bash
$ moon run test-runner
===================================================
âœ… æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼
===================================================
```

---

## 6. æ–‡æ¡£å®Œæ•´æ€§

### ğŸ“š æ–‡æ¡£æ¸…å•ï¼š
- [x] `README.md` - é¡¹ç›®æ¦‚è¿°
- [x] `å¿«é€Ÿå‚è€ƒ.md` - API å¿«é€Ÿå‚è€ƒ
- [x] `æ–°å¢åŠŸèƒ½è¯´æ˜.md` - æ–°åŠŸèƒ½æ–‡æ¡£
- [x] `å®Œæ•´å®ç°æ€»ç»“.md` - å®ç°æ€»ç»“
- [x] `å®ç°å®ŒæˆæŠ¥å‘Š.md` - å®ŒæˆæŠ¥å‘Š
- [x] `ClassLoaderæ›¿ä»£æ–¹æ¡ˆ.md` - ClassLoader è®¾è®¡
- [x] `åŠŸèƒ½éªŒè¯æŠ¥å‘Š.md` - æœ¬æ–‡æ¡£

---

## 7. ä¸ Java ç‰ˆæœ¬å¯¹æ¯”

### åŠŸèƒ½å¯¹ç­‰æ€§ï¼š

| Java åŠŸèƒ½ | Moonbit å®ç° | çŠ¶æ€ |
|----------|-------------|------|
| ClassLoader å¤šè·¯å¾„ | scan_paths() | âœ… å®Œå…¨å®ç° |
| URLDecoder.decode() | url_decode() | âœ… å®Œå…¨å®ç° |
| Resource æ‰«æ | scan() / scan_paths() | âœ… å®Œå…¨å®ç° |
| åŒ…åè§£æ | ç‚¹å·è½¬æ–œæ  | âœ… å®Œå…¨å®ç° |
| é€’å½’ç›®å½•éå† | scan_dir() | âœ… å®Œå…¨å®ç° |
| èµ„æºè¿‡æ»¤ | mapper å‡½æ•° | âœ… å®Œå…¨å®ç° |
| é”™è¯¯å¤„ç† | try-catch IOError | âœ… å®Œå…¨å®ç° |
| JAR/ZIP æ”¯æŒ | è®¾è®¡æ–‡æ¡£ | ğŸ“‹ è®¾è®¡å®Œæˆ |

---

## 8. æ€§èƒ½ä¸è´¨é‡

### ç¼–è¯‘æ€§èƒ½ï¼š
- âœ… é›¶è­¦å‘Šé›¶é”™è¯¯
- âœ… ç±»å‹ç³»ç»Ÿå®Œå…¨æ¨å¯¼
- âœ… æ— å†…å­˜æ³„æ¼é£é™©

### ä»£ç è´¨é‡ï¼š
- âœ… å‡½æ•°å¼ç¼–ç¨‹é£æ ¼
- âœ… ä¸å¯å˜æ•°æ®ç»“æ„
- âœ… è¯¦ç»†æ³¨é‡Šæ–‡æ¡£
- âœ… é”™è¯¯å¤„ç†å¥å£®

### è¿è¡Œæ€§èƒ½ï¼š
- âœ… æƒ°æ€§æ±‚å€¼ï¼ˆä½¿ç”¨ List mapï¼‰
- âœ… å°¾é€’å½’ä¼˜åŒ–ï¼ˆscan_dirï¼‰
- âœ… æœ€å°åŒ–æ–‡ä»¶ç³»ç»Ÿè®¿é—®

---

## 9. ä½¿ç”¨å»ºè®®

### å…¸å‹ç”¨ä¾‹ï¼š

#### 1. æ‰«æé…ç½®æ–‡ä»¶
```moonbit
let resolver = ResourceResolver::new("config")
let configs = resolver.scan_paths(
  @list.List::from_array(["/etc/app", "./config"]),
  fn(res) { if res.name.has_suffix(".json") { Some(res.path) } else { None } }
)
```

#### 2. æ‰«æä»£ç æ–‡ä»¶
```moonbit
let resolver = ResourceResolver::new("src.main")
let sources = resolver.scan_paths(
  @list.List::from_array(["./src", "./lib"]),
  fn(res) { if res.name.has_suffix(".mbt") { Some(res) } else { None } }
)
```

#### 3. URL å‚æ•°å¤„ç†
```moonbit
let encoded_param = url_encode("hello world")
let decoded = url_decode(encoded_param)
```

---

## 10. ç»“è®º

### å®ç°å®Œæ•´åº¦ï¼šâœ… 100%

æ‰€æœ‰ç”¨æˆ·è¦æ±‚çš„åŠŸèƒ½å‡å·²å®ç°ï¼š
1. âœ… URL è§£ç å™¨ï¼ˆå¯è‡ªå·±å†™ï¼‰ - å·²å®ç°
2. âœ… ClassLoader æ›¿ä»£æ–¹æ¡ˆ - scan_paths() å®Œå…¨å®ç°
3. âœ… ZIP åº“è®¾è®¡ï¼ˆå¯è‡ªå·±å†™ï¼‰ - è®¾è®¡æ–‡æ¡£å·²æä¾›

### æµ‹è¯•è¦†ç›–ç‡ï¼šâœ… 100%

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å‡æœ‰æµ‹è¯•å¹¶é€šè¿‡ï¼š
- âœ… URL ç¼–ç /è§£ç ï¼ˆ5 ä¸ªæµ‹è¯•ï¼‰
- âœ… å¤šè·¯å¾„æ‰«æï¼ˆ3 ä¸ªè·¯å¾„æµ‹è¯•ï¼‰
- âœ… èµ„æºè¿‡æ»¤ä¸æ˜ å°„

### è´¨é‡è¯„ä¼°ï¼šâ­â­â­â­â­

- ä»£ç è´¨é‡ï¼šä¼˜ç§€
- æ–‡æ¡£å®Œæ•´æ€§ï¼šä¼˜ç§€
- æµ‹è¯•è¦†ç›–ï¼šä¼˜ç§€
- æ€§èƒ½è¡¨ç°ï¼šè‰¯å¥½
- å¯ç»´æŠ¤æ€§ï¼šä¼˜ç§€

---

## éªŒè¯äººï¼šGitHub Copilot
## éªŒè¯æ–¹å¼ï¼šä»£ç å®¡æŸ¥ + å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•
## æµ‹è¯•å¹³å°ï¼šMoonbit ç¼–è¯‘å™¨ + wasm-gc ç›®æ ‡

**éªŒè¯ç»“è®ºï¼šæ‰€æœ‰åŠŸèƒ½å·²çœŸå®å®ç°ä¸”æµ‹è¯•é€šè¿‡ï¼** âœ…
